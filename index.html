<!DOCTYPE html>
<html>
<head>
  <title>Spoken Bookmark</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
    button { font-size: 24px; padding: 20px; margin: 10px; }
    audio { margin-top: 20px; width: 300px; }
  </style>
</head>
<body>
  <h1>üìñ Spoken Bookmark</h1>
  <p>Press the <b>spacebar</b> or tap the button to Stop/Resume reading.</p>

  <button id="toggleButton">‚èØÔ∏è Stop / Resume</button>

  <audio id="player" controls></audio>

  <script>
    let isReading = false; 
    const user = "john";   // test user
    const book = "Bible";  // test book
    const player = document.getElementById("player");

    function playAudioFromAPI(endpoint, payload) {
      fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      })
      .then(response => {
        if (!response.ok) throw new Error("API error");
        return response.blob();
      })
      .then(blob => {
        const url = URL.createObjectURL(blob);
        player.src = url;
        player.play();
      })
      .catch(err => console.error(err));
    }

    function toggleCommand() {
      if (isReading) {
        // STOP
        playAudioFromAPI("https://audible-bookmark-api.onrender.com/stop", {
          user: user, book: book, chapter: 1, paragraph: 1, sentence: 1
        });
        isReading = false;
      } else {
        // RESUME
        playAudioFromAPI("https://audible-bookmark-api.onrender.com/command", {
          user: user, book: book, command: "RESUME"
        });
        isReading = true;
      }
    }

    // Button click
    document.getElementById("toggleButton").addEventListener("click", toggleCommand);

    // Spacebar press
    document.addEventListener("keydown", function(event) {
      if (event.code === "Space") {
        toggleCommand();
        event.preventDefault(); 
      }
    });
  </script>
</body>
</html>
